function LoginHeraderChange(){$(document).off("click",".user-nav #Logout").on("click",".user-nav #Logout",function(){$.get("/RegistLogin/LoginOut?t="+Math.random(),function(n){n.statuesCode=="ok"&&$.get("/Qikan/RegistLogin/LoginView?t="+Math.random(),function(n){$("#user-nav").find("li").remove();$("#user-nav").append(n);$(".user-nav #login-btn").off("click");$(".user-nav #login-btn").on("click",function(){loginAction()})})})})}function loginAction(){index=layer.open({id:1,type:1,skin:"layui-layer-rim login",title:" ",area:["350px","300px"],anim:0,move:!1,resize:!1,content:$("#login"),success:function(){$("input[name='VerificationCode']").val("");$(".code-img>img").attr("src","/Qikan/RegistLogin/VerficationCode?"+Math.random())}})}var callParams=[],callBackFunction;(function(){$(document).ready(function(){layui.use(["element","layer","form"],function(){function r(t,i){var e=!1,f,r,u;if(n.ajax({url:"/RegistLogin/CheckUserIslogin?"+Math.random(),dataType:"json",async:!1,success:function(n){e=n.isLogined},error:function(){e=!1}}),e){if(t){if(f="",i)for(r=0;r<i.length;r++)u=i[r],isNaN(i[r])&&(u="'"+i[r]+"'"),f==""?f=/^[\d.]+$/.test(u)?"'"+u.toString()+"'":u:f+=/^[\d.]+$/.test(u)?",'"+u.toString()+"'":","+u;eval("callbackFuntion("+f+")")}}else{if(callBackFunction=t||LoginHeraderChange,f="",i)for(r=0;r<i.length;r++)u=i[r],isNaN(i[r])&&(u="'"+i[r]+"'"),f==""?f=u:f+=","+u;callParams=f;loginAction()}}var i=layui.form,u=layui.laypage,n=layui.jquery,t=layui.layer;callBackFunction=LoginHeraderChange;i.on("submit(Login)",function(i){return i.field.LoginType="normallogin",i.field.PToken=AesEncrypt(i.field.LoginUserPassword),i.field.LoginUserPassword=n.md5(i.field.LoginUserPassword),n.ajax({url:"/RegistLogin/Login",data:i.field,type:"post",dataType:"json",beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(i){n("input[name='LoginUserPassword']").val("");i.Status?(n.get("/Qikan/RegistLogin/LoginView",{t:Math.random()},function(t){n("#user-nav").find("li").remove();n("#user-nav").append(t);callBackFunction&&(callBackFunction==LoginHeraderChange?LoginHeraderChange():(LoginHeraderChange(),eval("callBackFunction("+callParams+")"),callBackFunction=LoginHeraderChange))}),t.closeAll("page")):i.StauesCode=="CodeErro"?t.alert(i.Msg,{title:"提示！"},function(i){n("input[name='VerificationCode']").val("");n(".code-img>img").attr("src","/Qikan/RegistLogin/VerficationCode?"+Math.random());t.close(i)}):i.StauesCode==="resetpassword"?t.alert("亲爱的客户您好！根据《网络安全法》和《通信网络安全防护管理办法》的有关规定，现系统监测到您的登录密码类属于网络安全威胁弱密码范畴，请尽快联系平台管理员修改您的密码后使用！",function(n){t.close(n)}):t.alert("用户名或密码错误",{title:"提示！"},function(i){n("input[name='VerificationCode']").val("");n(".code-img>img").attr("src","/Qikan/RegistLogin/VerficationCode?"+Math.random());t.close(i)})},error:function(){t.alert("用户名或密码错误",{title:"提示！"},function(i){n("input[name='VerificationCode']").val("");n(".code-img>img").attr("src","/Qikan/RegistLogin/VerficationCode?"+Math.random());t.close(i)})}}),!1});n("#IPLogin").on("click",function(){var i={};i.LoginType="iplogin";n.ajax({url:"/RegistLogin/Login",data:i,type:"post",async:!0,dataType:"json",beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(i){i.Status?(n.get("/Qikan/RegistLogin/LoginView",{t:Math.random()},function(t){n("#user-nav").find("li").remove();n("#user-nav").append(t);callBackFunction&&(callBackFunction==LoginHeraderChange?LoginHeraderChange():(LoginHeraderChange(),eval("callBackFunction("+callParams+")"),callBackFunction=LoginHeraderChange))}),t.closeAll("page")):t.alert("登录失败",{title:"提示！"})},error:function(){t.alert("登录失败",{title:"提示！"})}})});n("#login").bind("keypress",function(t){var i=t||window.event,r=i.keyCode||i.which||i.charCode;r==13&&n("#normalLogin").click()});n("#login ul li").bind("click",function(){n(this).text()=="用户登录"&&(n(".login-switch a").hasClass("text")&&n(".login-switch a").removeClass("text").addClass("code"),iCount!=null&&(clearInterval(iCount),iCount=null))});window.checklogin=r})})})();