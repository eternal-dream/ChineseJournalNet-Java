layui.use(["form","layer"],function(){function r(n){var u,t,f,o,e,i,r,s;if(u=$.parseXML(document.getElementById("xmlContent").value.replace(/\r\n/gi,"")),f=location.protocol+"//"+location.host+"/",o=navigator.appName,window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("MSIE")>=0||o=="Microsoft Internet Explorer")try{t=new ActiveXObject("Msxml2.FreeThreadedDOMDocument");t.async=!1;t.load("/Export/"+n);e=new ActiveXObject("Msxml2.XSLTemplate");e.stylesheet=t;i=e.createProcessor();i.input=u;i.addParameter("domailUrl",f);i.transform();document.getElementById("showArea").innerHTML=i.output}catch(h){}else try{$.ajax({async:!1,url:"/Export/"+n}).done(function(n){t=n});r=new XSLTProcessor;r.importStylesheet(t);r.setParameter(null,"domailUrl",f);s=r.transformToDocument(u);document.getElementById("showArea").innerHTML=s.documentElement.innerHTML}catch(h){}}function u(t,i){if(t===null||t===undefined||$.trim(t)==""){n.msg("内容为空");return}var r=document.getElementById("TempForm");r&&(r.action="/Qikan/Search/ExportFile",r.target="_self",r.method="post",r.content.value=JSON.stringify(t),r.filename.value=i,r.submit())}var f=layui.form,n=layui.layer,t="",i=!1;$(document).off("click","a[data-key=export]").on("click","a[data-key=export]",function(){exportArticle()});window.exportArticle=function(){var i="";if(i=getSessionSelectArticle(),i=="")return n.msg("请选择要导出的文献！"),!1;t=i;$.StandardPostNewWindow("/Qikan/Search/Export",{ids:i,strType:"title_info"})};$(".export-type li").on("click",function(){var n=$(this).data("type");n=="txt"?($("#nomar").css("display","none"),$("#exportform").css("display","block"),$(".export-op").css("display","none"),$("#exportform .layui-tab-item").addClass("layui-show")):($(".export-op").css("display","block"),$("#nomar").css("display","block"),$("#exportform").css("display","none"));n=="xml"||n=="xmlfirstnode"?m_ShowXml(n):n=="excel"?m_ExportExcel():m_ShowInfo(n)});window.m_ShowInfo=function(n){i=!1;var t=document.getElementById("printbtn"),u=document.getElementById("copybtn"),f=document.getElementById("showArea"),e=document.getElementById("customExportDiv"),o=document.getElementById("exportbtn");n=="text"?r(n+".xsl"):n=="txt"||(n=="chaxin"?r(n+".xsl"):r(n+".xsl"))};window.m_ShowXml=function(n){i=!0;var t=document.getElementById("showArea");t.innerHTML=n=="xmlfirstnode"?document.getElementById("xmlFirstNode").value.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n+/g,"<BR/>"):document.getElementById("xmlContent").value.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n+/g,"<BR/>")};window.m_ExportFile=function(){var t=new Date,n=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getSeconds(),r,f;i?(f=$("#showArea").text(),r={content:f,act:"xml"},n=$(".layui-this").data("type")=="xmlfirstnode"?n+"@cqvip.txt":n+"@cqvip.xml"):(r={content:$("#showArea").html(),act:"html"},n=n+"@cqvip.txt");u(r,n)};window.m_ExportExcel=function(){var r=this.document.getElementById("ids").value,i,t;if(r!=""){if(i={ids:r},JSON.stringify(i)==""){n.msg("文章ID为空");return}t=document.getElementById("TempForm");t&&(t.action="/Qikan/Search/ExportExcel",t.target="_self",t.method="post",t.content.value=JSON.stringify(i),t.submit())}};window.m_CustomExportFile=function(){var f="",i="",r=new Date,e,o;if($("input[cname='cbitem']:checked").each(function(){i+=","+this.value}),i.length==0){n.msg("请选择输出项");return}(i=i.substring(1,i.length),f=r.getFullYear()+"-"+(r.getMonth()+1)+"-"+r.getDate()+" "+r.getSeconds(),t=this.document.getElementById("ids").value,t!="")&&(e=t,o={strIds:e,strType:"title_info",act:"custom",customFields:i,sType:""},u(o,f+"@cqvip.txt"))};window.m_Copy=function(){var t=document.getElementById("showArea"),u,r,i,f,o;if(document.body.createControlRange)t.contentEditable="true",u=document.body.createControlRange(),u.addElement(t),u.execCommand("Copy"),t.contentEditable="false",n.msg("成功复制到剪贴板！");else{try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(s){n.msg("被浏览器拒绝！\n请在浏览器地址栏输入'about: config'并回车\n然后将'signed.applets.codebase_principal_support'设置为'true");return}if(r=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard),!r)return;if(i=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable),!i)return;i.addDataFlavor("text/unicode");var e={},e=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);if(alert(t.innerHTML),f=t.innerHTML.replace(/<br>/gi,"\r\n").replace(/&lt;/g,"<").replace(/&gt;/g,">"),e.data=f,i.setTransferData("text/unicode",e,f.length*2),o=Components.interfaces.nsIClipboard,!r)return!1;r.setData(i,null,o.kGlobalClipboard);n.msg("成功复制到剪贴板！")}}});