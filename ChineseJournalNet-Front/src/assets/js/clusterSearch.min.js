layui.use(["element","form","layer"],function(){function t(t,i,r,u){var o=n("#searchType").val(),e,s,f;o=="normal"?(f=getSearchParamModel(),f.ClusterFilter=r==1?i==t||i==""||t==""?t:i.indexOf(t)>=0?i:i+"[_]"+t:t,f.SType="",f.StrIds="",f.PageNum=1,n(u).attr("data-ClusterUseType")=="Article"&&(f.ClusterUseType="Article"),search(f)):o=="advance"&&(e="",u.parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return e=n(this).data("guid"),!1}),s=n("div[data-guid="+e+"]").find("input[name=searchParamModelJson]").val(),f=JSON.parse(s),f.ClusterFilter=r==1?i==t||i==""||t==""?t:i+"[_]"+t:t,f.SType="",f.StrIds="",f.PageNum=1,n(u).attr("data-ClusterUseType")=="Article"&&(f.ClusterUseType="Article"),advSearch(f,e))}var r=layui.form,u=layui.element,n=layui.$,i=layui.layer;u.on("collapse(leftcluser)",function(n){var i=n.content.children(".cluster-term").height()+n.content.children(".cluster-list").height()+n.content.children(".cluster-year-sel").height(),t;n.content.hasClass("extend-show")?(n.content.css("max-height",i),n.content.removeClass("extend-show")):(t=n.content.css("max-height"),t=t.replace("px",""),parseInt(t)>170?n.content.css("max-height",170):n.content.css("max-height",i))});n(document).on("click","#classCluster li i,#areaCluster li i,#organCluster li i,#rangeCluster li i",function(){var s=arguments.callee.caller.arguments[0]||window.event,h=s.target.nodeName.toLowerCase(),e;if(h!=="i")return!1;var i=n(this),u=i.parent().parent().children("ul"),o=i.parent().parent().parent().prev("ul");if(u.length)i.hasClass("icon-plus")?(u.show(),i.removeClass("icon-plus").addClass("icon-minus")):(u.hide(),i.removeClass("icon-minus").addClass("icon-plus")),u.children().each(function(){if(o.length){var t=!1,i=n(this).children("a").data("search");o.children().each(function(){if(i==n(this).children("a").data("search")){t=!0;return}});t&&n(this).remove()}});else{var c=i.data("item"),f="title_info",e=getSearchParamModel(),l=e.ObjectType;switch(l){case 1:f="title_info";break;case 7:f="media_info";break;case 3:f="writer_info";break;case 6:f="organ_info";break;default:f="title_info"}e=getSearchParamModel();i.removeClass("icon-plus").addClass("icon-loading");n.ajax({url:"/Search/ClusterExtend",type:"post",dataType:"html",data:{searchParamModel:JSON.stringify(e),clusterValue:c,sType:f},success:function(f){var s,h;i.parent().after(f);i.removeClass("icon-loading").addClass("icon-minus");i.parents(".layui-colla-content").css("max-height")!=undefined&&(s=i.parents(".layui-colla-content").css("max-height"),s=s.replace("px",""),h=i.parents(".layui-colla-content").children(".cluster-term").height()+i.parents(".layui-colla-content").children(".cluster-list").height(),h>s&&(i.parents(".layui-colla-content").hasClass("extend-show")||i.parents(".layui-colla-content").addClass("extend-show"),i.parents(".layui-colla-content").prev().click()));u=i.parent().parent().children("ul");u.children().each(function(){if(o.length){var t=!1,i=n(this).children("a").data("search");o.children().each(function(){if(i==n(this).children(".cluster-close").data("search")){t=!0;return}});t&&n(this).remove()}});n(".layui-colla-item ul li a ul li a").on("click",function(i){var o=n("#searchType").val(),r,u,f;o=="advance"&&(r="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return r=n(this).data("guid"),!1}),u=n("div[data-guid="+r+"]").find("input[name=searchParamModelJson]").val(),e=JSON.parse(u));f=e.ClusterFilter;t(n(this).data("search"),f,1,n(this));i.stopPropagation()});r.render()},error:function(){}})}});n(document).off("click",".cluster-close").on("click",".cluster-close",function(){var s=arguments.callee.caller.arguments[0]||window.event,u,o,i,f;layui.stope(s);var r=n(this).data("search"),e=getSearchParamModel(),h=n("#searchType").val();h=="advance"&&(u="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return u=n(this).data("guid"),!1}),o=n("div[data-guid="+u+"]").find("input[name=searchParamModelJson]").val(),e=JSON.parse(o));i=e.ClusterFilter;f="";f=i.indexOf("[_]"+r)>=0?i.replace("[_]"+r,""):i.indexOf(r+"[_]")>=0?i.replace(r+"[_]",""):i.replace(r,"");t(f,i,0,n(this))});n(document).on("click",".layui-colla-item ul li a",function(){var o=arguments.callee.caller.arguments[0]||window.event,s=o.target.nodeName.toLowerCase(),u,r,f,e,i;if(s!=="a")return!1;n(this).hasClass("cluster-xg")?(i=getSearchParamModel(),i.ObjectSearchType=n(this).data("search"),search(i)):(i=getSearchParamModel(),u=n("#searchType").val(),u=="advance"&&(r="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return r=n(this).data("guid"),!1}),f=n("div[data-guid="+r+"]").find("input[name=searchParamModelJson]").val(),i=JSON.parse(f)),e=i.ClusterFilter,t(n(this).data("search"),e,1,n(this)))});n(document).on("click","#leftSearch",function(){var f=n("select[name='leftIdentifier']").val(),u=n("input[name='leftSearchKeywords']").val(),e=f+"="+u,o=getSearchParamModel(),c=n("#searchType").val(),r,s,h;if(c=="advance"&&(r="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return r=n(this).data("guid"),!1}),f=n("div[data-guid="+r+"]").find("select[name='leftIdentifier']").val(),u=n("div[data-guid="+r+"]").find("input[name='leftSearchKeywords']").val(),e=f+"="+u,s=n("div[data-guid="+r+"]").find("input[name=searchParamModelJson]").val(),o=JSON.parse(s)),h=o.ClusterFilter,u=="")return i.msg("请输入检索词！"),!1;t(e,h,1,n(this))});n(document).on("click","#ObjectLeftSearch",function(){var s=n("select[name='leftIdentifier']").val(),u=n("input[name='leftSearchKeywords']").val(),h=s+"="+u,f=getSearchParamModel(),c=n("#searchType").val(),r,e,o;if(c=="advance"&&(r="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return r=n(this).data("guid"),!1}),e=n("div[data-guid="+r+"]").find("input[name=searchParamModelJson]").val(),f=JSON.parse(e)),o=f.ClusterFilter,u=="")return i.msg("请输入检索词！"),!1;t(h,o,1,n(this))});n(document).on("click","#objectSearch",function(){var t="",f=n("select[name='leftIdentifier']").val(),i=n("input[name='leftSearchKeywords']").val(),r,u;i!=""&&(t=f+"="+i);r=1;u=n(this).data("objecttype");n.StandardPost("/Qikan/Search/Index",{key:encodeURIComponent(t),objectType:u,isLog:r})});n(document).on("keyup","#leftSearchKeywords",function(t){var i=window.event||t,r=i.keyCode||i.which;r==13&&n("#objectSearch").trigger("click")});n(document).on("click","#leftSearchForNot",function(){var f=n("select[name='leftIdentifier']").val(),u=n("input[name='leftSearchKeywords']").val(),e=f+"= NOT "+u,o=getSearchParamModel(),c=n("#searchType").val(),r,s,h;if(c=="advance"&&(r="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return r=n(this).data("guid"),!1}),f=n("div[data-guid="+r+"]").find("select[name='leftIdentifier']").val(),u=n("div[data-guid="+r+"]").find("input[name='leftSearchKeywords']").val(),e=f+"= NOT "+u,s=n("div[data-guid="+r+"]").find("input[name=searchParamModelJson]").val(),o=JSON.parse(s)),h=o.ClusterFilter,u=="")return i.msg("请输入检索词！"),!1;t(e,h,1,n(this))});window.goStop=function(n){n.preventDefault?n.preventDefault():n.returnValue=!1};n(document).off("click",".journal-guid .list-abc a").on("click",".journal-guid .list-abc a",function(){var r=getSearchParamModel(),u=r.ClusterFilter,f=n(this).data("search"),i;t(f,u,1,n(this));i=arguments.callee.caller.arguments[0]||window.event;goStop(i)});n(document).off("click",".journal-guid .journal-class-list a").on("click",".journal-guid .journal-class-list a",function(){var r=getSearchParamModel(),u=r.ClusterFilter,f=n(this).data("search"),i;t(f,u,1,n(this));i=arguments.callee.caller.arguments[0]||window.event;goStop(i)});window.getClusterYear=function(){var t,i;return str=(t=n("select[name=cluster_beginYear]").val(),i=n("select[name=cluster_endYear]").val(),i<t)?"false":t+"-"+i}});