var pluginCover=function(){function i(i){undefined!=i&&($.extend(n,i),$.ajax({type:"get",url:"/Journal/InitSelect",dataType:"json",data:{gch:n.gch,id:n.id},success:function(i){$($.parseXML(i.fmpicxml)).find("years").each(function(){var n=$(this).attr("value");$("#dropJournalYear").append("<option value='"+n+"'>"+n+"<\/option>")});n.fmpicxml=$.parseXML(i.fmpicxml);n.mpicxml=$.parseXML(i.mpicxml);n.fdpicxml=$.parseXML(i.fdpicxml);t(n.fmpicxml,$("#dropJournalYear").val());layui.use(["element","layer","form"],function(){var n=layui.form;n.render("select")});var r=$("#dropCoverType").val(),u=$("#dropJournalYear").val(),f=$("#dropJournalNum").val();$.get("/Qikan/Journal/GetImageList",{gch:n.gch,year:u,num:f,imgtype:r},function(t){$("#imglist ul").html(t);var i=$("#imglist ul").find("li.current").find("img"),r=i.attr("src"),u=r.replace(n.smallPath,"");$("#bigimg").attr("src",n.bigPath+u)})}}))}function r(){var n=$("#bigimg").attr("src");document.all.a1==undefined?(objIframe=document.createElement("a"),document.body.appendChild(objIframe),objIframe.outerHTML="<a name='a1' id='a1' style='width:400px;hieght:300px' target='_blank' href='"+n+"' download='封面.jpg'><\/a>"):document.getElementById("a1").href=$("#bigimg").attr("src");document.all.a1.click()}function t(n,t){var i="",r="",u="",f=$(n).find("years[value='"+t+"']>num").length;$(n).find("years[value='"+t+"']>num").each(function(n){var t=$(this).text(),e="",o=$(this).attr("gch");e=t.length==1?"00"+t:"0"+t;n==0&&(r=e,u=t);i+=n==f-1?"<option selected data-gch='"+o+"' value='"+e+"'>"+t+"<\/option>":"<option data-gch='"+o+"' value='"+e+"'>"+t+"<\/option>"});$("#dropJournalNum").append(i)}function u(n){$(n).attr("src","../../dist/images/defaultserror.jpg");$(n).attr("iserror","true");n.onerror=null}function f(n){$(n).attr("src","../../dist/images/defaultberror.jpg");$(n).attr("iserror","true");$(".save").hide();$(".print").hide();n.onerror=null}var n={gch:"",id:"",name:"",fmpicxml:"",fdpicxml:"",mpicxml:"",bigPath:"http://image1.cqvip.com/vip/qkhclearimg/",smallPath:"http://image1.cqvip.com/vip/qk/"};layui.use(["element","layer","form"],function(){var i=layui.form;i.on("select(dropCoverType)",function(r){var u=parseInt(r.value);$("#dropJournalYear").empty();$("#dropJournalNum").empty();u==0?($(n.fmpicxml).find("years").each(function(){var n=$(this).attr("value");$("#dropJournalYear").append("<option value='"+n+"'>"+n+"<\/option>")}),t(n.fmpicxml,$("#dropJournalYear").val())):u==1?($(n.fdpicxml).find("years").each(function(){var n=$(this).attr("value");$("#dropJournalYear").append("<option value='"+n+"'>"+n+"<\/option>")}),t(n.fdpicxml,$("#dropJournalYear").val())):u==2&&($(n.mpicxml).find("years").each(function(){var n=$(this).attr("value");$("#dropJournalYear").append("<option value='"+n+"'>"+n+"<\/option>")}),t(n.mpicxml,$("#dropJournalYear").val()));i.render("select")});i.on("select(dropJournalYear)",function(r){var u=parseInt(r.value);$("#dropJournalNum").empty();t(n.fmpicxml,u,!0);i.render("select")})});$("#btnRight").on("click",function(){var t=$("#imglist").find("li.current"),f=t.index(),i=t.next(),e=t.nextAll().length,o=$("#imglist ul li").length,r;if(e==0)return!1;o-f>7&&(r=parseInt($("#imglist ul").css("margin-left")),$("#imglist ul").css("margin-left",r+-130+"px"));var u=i.find("img"),s=u.attr("iserror"),h=u.attr("src"),c=h.replace(n.smallPath,"");$("#bigimg").attr("src",n.bigPath+c);s=="true"?($(".save").hide(),$(".print").hide()):($(".save").show(),$(".print").show());t.removeClass("current");i.addClass("current")});$("#btnLeft").on("click",function(){var t=$("#imglist").find("li.current"),r=t.prev(),f=t.prevAll().length,i;if(f==0)return!1;i=parseInt($("#imglist ul").css("margin-left"));i!=0&&$("#imglist ul").css("margin-left",i+130+"px");var u=r.find("img"),e=u.attr("iserror"),o=u.attr("src"),s=o.replace(n.smallPath,"");$("#bigimg").attr("src",n.bigPath+s);e=="true"?($(".save").hide(),$(".print").hide()):($(".save").show(),$(".print").show());t.removeClass("current");r.addClass("current")});$("#btnFindImg").on("click",function(){var t=$("#dropCoverType").val(),i=$("#dropJournalYear").val(),r=$("#dropJournalNum").val(),u=$("#dropJournalNum").find("option:selected").attr("data-gch");$.ajax({url:"/Qikan/Journal/GetImageList",type:"post",async:!0,dataType:"json",data:{gch:u,year:i,num:r,imgtype:t},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(t){$("#imglist ul").html(t);var i=$("#imglist ul").find("li.current").find("img").attr("src");i?(cli=i.replace(n.smallPath,""),$("#bigimg").attr("src",n.bigPath+cli),$(".save").show(),$(".print").show()):$("#bigimg").attr("src","")},error:function(){}})});$("#imglist ul").on("click","li a",function(){var t=$(this).find("img"),i=t.attr("iserror"),r=t.attr("src"),u=r.replace(n.smallPath,"");$("#imglist ul li").removeClass("current");$(this).parent("li").addClass("current");$("#bigimg").attr("src",n.bigPath+u);i=="true"?($(".save").hide(),$(".print").hide()):($(".save").show(),$(".print").show())});$(".save").on("click",function(){r()});$(".print").on("click",function(){var i=location.href,t=window.document.body.innerHTML,n=t.substring(t.indexOf("<!--startprint-->")+17),n=n.substring(0,n.indexOf("<!--endprint-->"));window.document.body.innerHTML=n;window.print();location.href=i});$("#bigimg").on("click",function(){$(this).hasClass("zoom-in")?($(this).addClass("zoom-out"),$(this).removeClass("zoom-in"),$(this).removeAttr("height")):($(this).addClass("zoom-in"),$(this).removeClass("zoom-out"),$(this).attr("height","100%"))});return{CJPlugin:i,imgebError:u,imgeBrror:f}}();