layui.use(["form","layer","jquery","cookie","element"],function(){var t=layui.form,i=layui.layer,n=layui.jquery,f=layui.cookie,u=layui.element,r;window.S4=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};window.createGuid=function(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()};window.addSelectArticleSession=function(r){var s="",e=[],f,o,u;if(r!=""){if(f=[],f=r.split(","),s=getSessionSelectArticle(),s=="")for(u=0;u<f.length;u++)e.push(f[u].toString());else{for(o=[],o=s.split(","),u=0;u<f.length;u++)n.inArray(f[u].toString(),o)<0&&e.push(f[u].toString());for(u=0;u<o.length;u++)e.push(o[u].toString())}if(e.length>500){for(i.msg("最多只能选择500条！"),u=0;u<f.length;u++)n("#articlelist").find("input[type=checkbox]").each(function(){var t=n(this).data("id");n.inArray(t.toString(),f)>=0&&n(this).prop("checked",!1)});n("input[name=selectArticleAll]").prop("checked",!1);t.render();return}setSessionSelectArticle(e.join(","))}};window.delSelectArticleSession=function(t){var u="",f,i,e,r;if(t!=""&&(f=[],f=t.split(","),u=getSessionSelectArticle(),u!="")){for(i=[],e=[],i=u.split(","),r=0;r<i.length;r++)n.inArray(i[r].toString(),f)<0&&e.push(i[r].toString());setSessionSelectArticle(e.join(","))}};t.on("submit(btn-search)",function(t){var i,r,u;n(this).parent().addClass("searching");i="";t.field.searchKeywords!=""&&(i=t.field.identifier+"="+t.field.searchKeywords);r=1;u=1;n.StandardPost("/Qikan/Search/Index",{key:encodeURIComponent(i),isNoteHistory:r,isLog:u,indexKey:t.field.searchKeywords,indexIdentifier:t.field.identifier})});window.bindAutoComplete=function(){n("#searchKeywords").AutoComplete({data:"/Qikan/Search/AutoComplate",timeout:3e3,ajaxParams:function(){return{objType:"articles".toLowerCase(),keyword:encodeURIComponent(n("input[name='searchKeywords']").val())}},ajaxDataType:"json",width:"auto",itemHeight:25,leftOffset:-6,maxItems:30,maxHeight:232,beforeLoadDataHandler:function(t){return t.length>=2?(n(".ac").show(),!0):(n(".ac").hide(),!1)},onerror:function(n){alert(n)},afterSelectedHandler:function(){var u,f;n("#btnSearch").parent().addClass("searching");var i="",r=n("select[name='identifier']").val(),t=n("input[name='searchKeywords']").val();t!=""&&(i=r+"="+t);u=1;f=1;n.StandardPost("/Qikan/Search/Index",{key:encodeURIComponent(i),isNoteHistory:u,isLog:f,indexKey:t,indexIdentifier:r})}})};bindAutoComplete();t.on("checkbox(selectArticleAll)",function(){var i=[],u=[],o=n("#searchType").val(),f,r,e;o=="advance"?(f="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return f=n(this).data("guid"),!1}),r=n(this).prop("checked"),n("div[data-guid="+f+"]").find("input[name=selectArticleAll]").each(function(){r?n(this).prop("checked",!0):n(this).prop("checked",!1)}),n("div[data-guid="+f+"]").find("div[id=articlelist]").find("input[type=checkbox]").each(function(){var t=n(this).data("id");r?(n(this).prop("checked",!0),n.inArray(t.toString(),i)<0&&i.push(t.toString())):(n(this).prop("checked",!1),n.inArray(t.toString(),u)<0&&u.push(t.toString()))}),n("div[data-guid="+f+"]").siblings().find("div[id=articlelist]").find("input[type=checkbox]").each(function(){var t=n(this).data("id");n.inArray(t.toString(),i)>=0?n(this).prop("checked",!0):n(this).prop("checked",!1)})):(r=n(this).prop("checked"),n("input[name=selectArticleAll]").each(function(){r?n(this).prop("checked",!0):n(this).prop("checked",!1)}),n("#articlelist").find("input[type=checkbox]").each(function(){var t=n(this).data("id");r?(n(this).prop("checked",!0),n.inArray(t.toString(),i)<0&&i.push(t.toString())):(n(this).prop("checked",!1),n.inArray(t.toString(),u)<0&&u.push(t.toString()))}));addSelectArticleSession(i.join(","));delSelectArticleSession(u.join(","));e=getSelectArticleCount();n('span[data-topcount="topcount"]').text(e);n('span[data-footcount="footcount"]').text(e);n("#selectArticleCount").text(e);t.render()});window.getSelectArticleCount=function(){var n=0,t=getSessionSelectArticle();return t!=""&&(n=t.split(",").length),n};n(document).on("click","#clearSelectArticle",function(){i.confirm("确认要清空已选文章吗?",{icon:3,title:"提示"},function(r){setSessionSelectArticle("");n(".selection-list dl").each(function(){n("input[data-id="+n(this).data("id")+"]").each(function(){n(this).prop("checked",!1)});n(this).remove()});n("input[name=selectArticleAll]").prop("checked",!1);t.render("checkbox");var u=getSelectArticleCount();n('span[data-topcount="topcount"]').text(u);n('span[data-footcount="footcount"]').text(u);n("#selectArticleCount").text(u);i.close(r)})});t.on("checkbox(selectArticle)",function(){var i=n(this).data("id"),r=n(this).prop("checked"),f=[],e=[],u,o;n("input[data-id="+i+"]").each(function(){r?(n(this).prop("checked",!0),n.inArray(i.toString(),f)<0&&f.push(i.toString())):(n(this).prop("checked",!1),n.inArray(i.toString(),e)<0&&e.push(i.toString()))});addSelectArticleSession(f.join(","));delSelectArticleSession(e.join(","));u=getSelectArticleCount();n('span[data-topcount="topcount"]').text(u);n('span[data-footcount="footcount"]').text(u);n("#selectArticleCount").text(u);r?(o=!0,n("#articlelist").find("input[type=checkbox]").each(function(){return r=n(this).prop("checked"),r?void 0:(o=!1,!1)}),o&&n("input[name=selectArticleAll]").prop("checked",!0)):n("input[name=selectArticleAll]").prop("checked",!1);t.render()});window.checkIsChecked=function(){var f=getSessionSelectArticle(),u,i,r;if(f!="")for(u=f.split(","),i=0;i<u.length;i++)n("input[data-id="+u[i]+"]").each(function(){n(this).prop("checked",!0);t.render("checkbox")});r=getSelectArticleCount();n('span[data-topcount="topcount"]').text(r);n('span[data-footcount="footcount"]').text(r);n("#selectArticleCount").text(r);t.render()};window.search=function(t){n("div[data-container=leftCluster]").html("");n(".leftcluser-loading").show();var i=JSON.stringify(t);n("#hidRequestsearchParamModel").val(i);n("#hid_searchtype").val("searchList");searchList(i)};window.searchList=function(i){n.ajax({url:"/Search/SearchList",type:"post",dataType:"html",data:{searchParamModel:i},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(i){n("#searchlist").html(i);checkIsChecked();n("html,body").animate({scrollTop:0},0);t.render();u.render()},error:function(){loaddingClose()}})};window.advSearch=function(i,r){i.AdvTabGuid=r;n("div[data-guid="+r+"]").find("div[data-container=leftCluster]").html("");n("div[data-guid="+r+"]").find(".leftcluser-loading").show();n.ajax({url:"/Search/SearchList",type:"post",dataType:"html",data:{searchParamModel:JSON.stringify(i)},beforeSend:function(){loadding()},complete:function(){},success:function(f){var e,o;n("#body >.l-width> .search-list").html(f);e=n("#body >.l-width> .search-list").find("input[name=preSearchParamModelJson]").val();e!=""&&(i=JSON.parse(e));n("#body >.l-width> .search-list").append('<input type="hidden" name="searchParamModelJson" value=\''+e+" ' />");o=n("div[data-guid="+r+"]");o.length>0?o.html(n("#body >.l-width> .search-list").html()):(n("#location>ul").append('<li data-guid="'+r+'"><a class="sel-close" href="javascript:void(0)"><i class="icon-close"><\/i><\/a><a href="javascript:void(0)" title="'+i.AdvShowTitle.replace(/\"/g,"")+'">'+i.AdvShowTitle.replace(/\"/g,"")+"<\/a><\/li>"),n("#location>ul").children("li:last-child").addClass("tab-this").prevAll().removeClass("tab-this"),addTabDiv(r));checkTabShowStatus();checkIsChecked();gotoLocation();t.render();u.render();loaddingClose()},error:function(){loaddingClose()}})};window.checkTabShowStatus=function(){for(var t=0;t<n("#location li").length;t++)n("#location li").length-5>t?n("#location li").eq(t).hide():n("#location li").eq(t).show()};window.gotoLocation=function(){n("html,body").animate({scrollTop:n(".advance").scrollTop()+n("#location").offset().top-n(".advance").offset().top-50},0)};n("#location>ul").on("click","li>a>i",function(t){layui.stope(t);var r=n(this).parent().parent(),i=r.data("guid");n("li[data-guid="+i+"]").next().length>0?r.hasClass("tab-this")&&(n("li[data-guid="+i+"]").next().addClass("tab-this"),n("li[data-guid="+i+"]").prevAll().removeClass("tab-this"),n("div[data-guid="+i+"]").next().show(),n("div[data-guid="+i+"]").prevAll().hide()):n("li[data-guid="+i+"]").prev().length>0&&r.hasClass("tab-this")&&(n("li[data-guid="+i+"]").prev().addClass("tab-this"),n("li[data-guid="+i+"]").prev().prevAll().removeClass("tab-this"),n("div[data-guid="+i+"]").prev().show(),n("div[data-guid="+i+"]").prev().prevAll().hide());n("li[data-guid="+i+"]").remove();n("div[data-guid="+i+"]").remove();checkTabShowStatus()});n(document).on("click","#location>ul>li",function(){n(this).addClass("tab-this").siblings().removeClass("tab-this");n("div[data-guid="+n(this).data("guid")+"]").show().siblings().hide();t.render()});n(document).on("click",".author .more.hide",function(){n(this).hide();n(this).siblings("span").show()});n(document).on("click",".fund .more.hide",function(){n(this).hide();n(this).siblings("span").show()});n(document).on("click",".list-op .articleRefence a",function(){i.closeAll();var r=n(this).data("stype"),t="";if(t=getSessionSelectArticle(),t==""){i.msg("请选择要查看的文献！");return}n.StandardPostNewWindow("/Qikan/Search/Index",{stype:r,strIds:t})});n(document).off("click","#articlelist .cited a,.article .cited a").on("click","#articlelist .cited a,.article .cited a",function(){n.StandardPostNewWindow("/Qikan/Search/Index",{stype:"by",strIds:n(this).data("articleid"),totalcount:n(this).data("zkbycount")})});n(document).on("click",".selection-tool .articleRefence a",function(){var r=n(this).data("stype"),t="";if(t=getSessionSelectArticle(),t==""){i.msg("请选择要查看的文献！");return}n.StandardPostNewWindow("/Qikan/Search/Index",{stype:r,strIds:t})});n(document).on("click",".list-op  .articleReport a",function(){var t,o,f,s,e,h,r,u;if(i.closeAll(),t=getSearchParamModel(),o=n("#searchType").val(),o=="advance"&&(f="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return f=n(this).data("guid"),!1}),s=n("div[data-guid="+f+"]").find("input[name=searchParamModelJson]").val(),t=JSON.parse(s)),e="",h=n(this).data("stype"),h=="chose"){if(r="",r=getSessionSelectArticle(),r==""){i.msg("请选择要统计分析的文献！");return}e=r}else if(t.ShowRules==""){i.msg("请先进行检索！");return}u=n("<form><\/form>").attr("action","/Qikan/Search/ArticleReport?from="+GetCurrentPath()).attr("method","post").attr("target","_blank");u.append(n("<input><\/input>").attr("name","searchParamModel").attr("type","hidden").attr("value",JSON.stringify(t)));u.append(n("<input><\/input>").attr("name","choseId").attr("type","hidden").attr("value",e));u.appendTo("body").submit().remove()});n(document).on("click",".selection-tool .articleReport a",function(){var u=getSearchParamModel(),h=n("#searchType").val(),f,o,e,s,t,r;if(h=="advance"&&(f="",n(this).parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return f=n(this).data("guid"),!1}),o=n("div[data-guid="+f+"]").find("input[name=searchParamModelJson]").val(),u=JSON.parse(o)),e="",s=n(this).data("stype"),s=="chose"){if(t="",t=getSessionSelectArticle(),t==""){i.msg("请选择要统计分析的文献！");return}e=t}else if(u.ShowRules==""){i.msg("请先进行检索！");return}r=n("<form><\/form>").attr("action","/Qikan/Search/ArticleReport?from="+GetCurrentPath()).attr("method","post").attr("target","_blank");r.append(n("<input><\/input>").attr("name","searchParamModel").attr("type","hidden").attr("value",JSON.stringify(u)));r.append(n("<input><\/input>").attr("name","choseId").attr("type","hidden").attr("value",e));r.appendTo("body").submit().remove()});n(document).on("click",".input-group .layui-btn-group .layui-btn,.input-group .layui-btn-group .layui-btn",function(){if(n(this).data("type")=="plus")n(".advance-input .input-group").length<5&&n(".advance-input").append(n("div[name=template] .input-group").clone());else if(n(this).data("type")=="minus"&&n(".advance-input .input-group").length>3){var i=n(this).parent().parent().parent();i.remove()}t.render()});window.addTabDiv=function(t){n("#tabDiv").append(n("#body >.l-width> .search-list").clone());n("#tabDiv").children("div:last-child").attr("data-guid",t).show().prevAll().hide()};n(document).off("click","#basic_searchdomainfilter .advance-submit .adv-search").on("click","#basic_searchdomainfilter .advance-submit .adv-search",function(){var c,t,e,r,u,f,o,s,h,l;for(n("#hid_searchtype").val("RetrievalSearchExpression"),c=n(".advance-input .input-group").length,t=new SearchParamModel,t.ObjectType=1,e="",r=0;r<c;r++)n("select[name='advIdentifier']").eq(r).val()!=""&&n("select[name='advIdentifier']").eq(r).val()!="undefined"&&n("input[name='advSearchKeywords']").eq(r).val()!=""&&n("select[name='advSearchKeywords']").eq(r).val()!="undefined"&&(u=new SearchKeyModel,r>0&&(u.PreLogicalOperator=n("select[name='logicalOperator']").eq(r-1).val(),e+=" "+u.PreLogicalOperator+" "),u.FieldIdentifier=n("select[name='advIdentifier']").eq(r).val(),e+=n("select[name='advIdentifier']").eq(r).find("option:selected").text(),e+="=",u.SearchKey=n("input[name='advSearchKeywords']").eq(r).val(),e+=u.SearchKey,u.IsExact=n("select[name='isExact']").eq(r).val(),u.SearchKey.trim()!=""&&t.SearchKeyList.push(u));if(t.AdvShowTitle=e,f=getSearchYearRange("basic_"),f=="false")return i.msg("开始时间不能大于结束时间！"),!1;if(f.indexOf("-")>=0)o=[],o=f.split("-"),t.BeginYear=o[0],t.EndYear=o[1],t.AdvShowTitle==""?t.AdvShowTitle="年份："+t.BeginYear+"-"+t.EndYear:t.AdvShowTitle+=" AND 年份："+t.BeginYear+"-"+t.EndYear,t.AdvShowTitle=t.AdvShowTitle.replace(/1900/g,"收录起始年");else if(f!=""){t.UpdateTimeType=f;t.AdvShowTitle!=""&&(t.AdvShowTitle+=" AND ");t.AdvShowTitle+="更新时间：";switch(f){case"1":t.AdvShowTitle+="一个月内";break;case"2":t.AdvShowTitle+="三个月内";break;case"3":t.AdvShowTitle+="半年内";break;case"4":t.AdvShowTitle+="一年内";break;case"5":t.AdvShowTitle+="当年内"}}s=getSearchJournalRange("basic_");s!=""&&(t.JournalRange=s,t.AdvShowTitle!=""&&(t.AdvShowTitle+=" AND "),t.AdvShowTitle+="期刊范围："+getSearchJournalRangeName("basic_"));h=getSearchDomainRange("basic_");h!=""&&(t.DomainRange=h,t.AdvShowTitle!=""&&(t.AdvShowTitle+=" AND "),t.AdvShowTitle+="学科限定："+getSearchDomainRangeName("basic_"));t.IsNoteHistory=1;n("input[name=basic_chn_en_extend]").prop("checked")&&(t.ChineseEnglishExtend=1);n("input[name=basic_synonym_extend]").prop("checked")&&(t.SynonymExtend=1);t.AdvShowTitle==""&&(t.AdvShowTitle="空检索");l=createGuid();advSearch(t,l)});n(document).off("click","#re_searchdomainfilter .advance-submit .adv-search").on("click","#re_searchdomainfilter .advance-submit .adv-search",function(){var s,t,r,u,f,e,o;if(n("#hid_searchtype").val("RetrievalBasicExpression"),s=n(".advance-input .input-group").length,t=new SearchParamModel,t.ObjectType=1,t.SearchExpression=n(".layui-textarea").val(),t.SearchExpression.trim()=="")return i.msg("请输入检索条件！"),!1;if(t.AdvShowTitle=t.SearchExpression,r=getSearchYearRange("re_"),r=="false")return i.msg("开始时间不能大于结束时间！"),!1;if(r.indexOf("-")>=0)u=[],u=r.split("-"),t.BeginYear=u[0],t.EndYear=u[1],t.AdvShowTitle==""?t.AdvShowTitle="年份："+t.BeginYear+"-"+t.EndYear:t.AdvShowTitle+=" AND 年份："+t.BeginYear+"-"+t.EndYear,t.AdvShowTitle=t.AdvShowTitle.replace(/1900/g,"收录起始年");else if(r!=""){t.UpdateTimeType=r;t.AdvShowTitle!=""&&(t.AdvShowTitle+=" AND ");t.AdvShowTitle+="更新时间：";switch(r){case"1":t.AdvShowTitle+="一个月内";break;case"2":t.AdvShowTitle+="三个月内";break;case"3":t.AdvShowTitle+="半年内";break;case"4":t.AdvShowTitle+="一年内";break;case"5":t.AdvShowTitle+="当年内"}}f=getSearchJournalRange("re_");f!=""&&(t.JournalRange=f,t.AdvShowTitle!=""&&(t.AdvShowTitle+=" AND "),t.AdvShowTitle+="期刊范围："+getSearchJournalRangeName("re_"));e=getSearchDomainRange("re_");e!=""&&(t.DomainRange=e,t.AdvShowTitle!=""&&(t.AdvShowTitle+=" AND "),t.AdvShowTitle+="学科限定："+getSearchDomainRangeName("re_"));t.AdvShowTitle==""&&(t.AdvShowTitle="空检索");t.IsNoteHistory=1;o=createGuid();advSearch(t,o)});n(document).off("keyup","input[name=advSearchKeywords]").on("keyup","input[name=advSearchKeywords]",function(t){var i=window.event||t,r=i.keyCode||i.which;r==13&&n("#basic_searchdomainfilter .advance-submit .adv-search").click()});window.getSearchDomainRangeName=function(t){var i="";return n("#"+t+"checkboxAllXueKe").prop("checked")==!1&&(n("#"+t+"searchDomain>ul>li>span").each(function(){n(this).find("input:checkbox:checked").prop("checked")==!0&&(i+=i!=""?","+n(this).find("input:checkbox").attr("title"):n(this).find("input:checkbox").attr("title"))}),n("#"+t+"searchDomain>ul>li>ul>li>span").each(function(){n(this).find("input:checkbox:checked").prop("checked")==!0&&n(this).parent().parent().prev().find("input:checkbox").prop("checked")==!1&&(i+=i!=""?","+n(this).find("input:checkbox").attr("title"):n(this).find("input:checkbox").attr("title"))})),i};window.getSearchJournalRangeName=function(t){var i="";return n("input[name="+t+"journalRange]:checked").each(function(){n(this).val()!=1&&(i+=i!=""?","+n(this).attr("title"):n(this).attr("title"))}),i};window.getSearchDomainRange=function(t){var i="";return n("#"+t+"checkboxAllXueKe").prop("checked")==!1&&(n("#"+t+"searchDomain>ul>li>span").each(function(){n(this).find("input:checkbox:checked").prop("checked")==!0&&(i+=i!=""?","+n(this).find("input:checkbox").val():n(this).find("input:checkbox").val())}),n("#"+t+"searchDomain>ul>li>ul>li>span").each(function(){n(this).find("input:checkbox:checked").prop("checked")==!0&&n(this).parent().parent().prev().find("input:checkbox").prop("checked")==!1&&(i+=i!=""?","+n(this).find("input:checkbox").val():n(this).find("input:checkbox").val())})),i};window.getSearchJournalRange=function(t){var i="";return n("input[name="+t+"journalRange]:checked").each(function(){n(this).val()!=1&&(i+=i!=""?","+n(this).val():n(this).val())}),i};window.getSearchYearRange=function(t){var i="",s=n("input[name="+t+"yearRange]:checked").val(),r,u,e,o,f;if(s==1)if(r=n("select[name="+t+"beginYear]").val(),u=n("select[name="+t+"endYear]").val(),e=new Date,o=e.getFullYear(),r==1900&&u==o)i="";else{if(u<r)return"false";i=r+"-"+u}else f=n("select[name="+t+"updateTimeType]").val(),typeof f=="undefined"&&(f=1),i=f;return i};t.on("checkbox(journalRange)",function(r){var u=n(this).data("type");r.value==1&&n(this).prop("checked")?(n("input[name="+u+"journalRange]").each(function(){n(this).prop("checked",!1)}),n(this).prop("checked",!0)):r.value!=1||n(this).prop("checked")?r.value!=1&&n(this).prop("checked")&&n("input[name="+u+"journalRange]").each(function(){n(this).val()==1&&n(this).prop("checked",!1)}):(i.msg("总得选一个吧！"),n(this).prop("checked",!0));t.render("checkbox")});window.showRemark=function(t){n(t).parent().parent().find(".abstract").html(n(t).prev().html());n(t).hide()};t.on("checkbox(basic_domainRangeAll)",function(){initDomainChekBox();t.render()});t.on("checkbox(re_domainRangeAll)",function(){initDomainChekBox();t.render()});t.on("checkbox(domainRangeFirstLevel)",function(){n(this).prop("checked")?n(this).parent().next().find(":checkbox").each(function(){n(this).prop("checked",!0).attr("disabled",!0)}):n(this).parent().next().find(":checkbox").each(function(){n(this).prop("checked",!1).attr("disabled",!1)});t.render()});n(".cluster-item .icon-arrow-right").parent().on("click",function(i){var u=i.target.nodeName.toLowerCase(),r=n(this).parent();r.hasClass("show-more")?r.removeClass("show-more"):r.addClass("show-more");layui.stope(i);t.render()});n(document).on("click",".btn-switch .layui-btn",function(){var t=n(this),i=t.data("type");r[i]?r[i].call(this,t):""});r={set:function(t){var i=t.data("key"),f=getSearchParamModel(),e,r,u;switch(f.ObjectType){case 1:n.cookie("LIBUSERSETARTICLELISTTYPECOOKIE",i,{expires:1,path:"/"});break;case 7:n.cookie("LIBUSERSETJOURNALLISTTYPECOOKIE",i,{expires:1,path:"/"})}e={};r=n("#searchType").val();r=="normal"?(n(".search-result-list>div").each(function(){n(this).hide()}),n("#"+i).show(),t.addClass("active").siblings().removeClass("active")):r=="advance"&&(u="",t.parents().each(function(){if(n(this).data("guid")!=undefined&&n(this).data("guid")!="")return u=n(this).data("guid"),!1}),n("div[data-guid="+u+"] .search-main .search-result-list>div").each(function(){n(this).attr("id")==i?n(this).show():n(this).hide()}),t.addClass("active").siblings().removeClass("active"))},order:function(i){var r=i.data("key"),u=getSearchParamModel(),f;u.Sort=r;switch(u.ObjectType){case 1:n.cookie("LIBUSERSETARTICLESORTCOOKIE",r,{expires:1,path:"/"});break;case 7:n.cookie("LIBUSERSETJOURNALSORTCOOKIE",r,{expires:1,path:"/"})}if(f=n("#searchType").val(),f=="normal")n.when(search(u)).done(function(){n("a[data-key="+r+"]").addClass("active").siblings().removeClass("active");t.render()});else if(f=="advance"){var e=i.parent().parent().parent().parent().parent().parent().data("guid"),o=i.parent().parent().parent().parent().parent().parent().find("input[name=searchParamModelJson]").val(),u=JSON.parse(o);u.Sort=r;n.when(advSearch(u,e)).done(function(){n("a[data-key="+r+"]").addClass("active").siblings().removeClass("active");t.render()})}}};window.bindSelectArticle=function(){var n="";if(n=getSessionSelectArticle(),n==""){i.msg("请选择要导出的文献！");return}selectArticle(n)};window.selectArticle=function(r){n.ajax({url:"/Qikan/WebControl/SelectArticle",type:"post",dataType:"html",data:{ids:r},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(r){n("#selection").html(r);t.render();i.open({type:1,skin:"layui-layer-rim login",title:" ",area:["650px","365px"],anim:0,resize:!1,content:n("#selection"),success:function(){}})},error:function(){}})};n(document).off("click",".indexArticleIconView").on("click",".indexArticleIconView",function(){var r=n(this).attr("data-pagurl"),u=n(this).attr("data-pagurl2"),t;if(r==""){i.msg("暂无预览");return}t=new Image;t.onerror=function(){var n=r;t.width=970;t.height=1388;t.src=u;t.onerror=null};t.src=r;n("#showImage").append(t);i.open({title:"在线预览",type:1,content:n("#showImage"),shadeClose:!0,scrollbar:!1,offset:["15px"],area:["990px","750px"],end:function(){n("#showImage").empty()}})});t.on("select(advIdentifierChange)",function(n){n.value=="C"&&n.othis.parent().next().children(".layui-btn").show()});n(document).off("click",".classbtn").on("click",".classbtn",function(){var r=n(this).prev();r.addClass("selecting");n("#category").find("input[type=checkbox]:checked").each(function(){n(this).prop("checked",!1)});t.render();i.open({type:1,title:"选择分类号",area:["720px","480px"],content:n("#category"),success:function(){},cancel:function(t){n("#category").hide();r.removeClass("selecting");i.close(t)}})});n(document).off("click","#category .class-box .cluster-list .icon-plus,#category .class-box .cluster-list .icon-minus").on("click","#category .class-box .cluster-list .icon-plus,#category .class-box .cluster-list .icon-minus",function(){var i=n(this),r=i.parent().parent().children("ul"),u;r.length?i.hasClass("icon-plus")?(r.show(),i.removeClass("icon-plus").addClass("icon-minus")):(r.hide(),i.removeClass("icon-minus").addClass("icon-plus")):(i.removeClass("icon-plus").addClass("icon-loading"),u=i.next().prop("checked"),n.ajax({url:"/WebControl/SelectExtendClassNo",type:"post",dataType:"html",data:{pid:n(this).parent().data("lngid"),chkStatus:u},success:function(n){i.removeClass("icon-loading").addClass("icon-minus");i.parent().parent().append(n);t.render()},error:function(){}}))});t.on("checkbox(chkClassNo)",function(i){var r=[],o=n("#hidSelectedClassNo").val(),u,f,e,s;o!=""&&(r=o.split(","));u=n(this).prop("checked");f=i.othis.parent().parent().children("ul");f.length&&f.find("input").each(function(){n(this).prop("checked",u)});u?(e=!1,s=n(this).parent().parent(),s.parents("li").each(function(){if(n(this).children("span").children("input").prop("checked"))return e=!0,!1}),e||n.inArray(i.elem.value.toString(),r)<0&&r.push(i.elem.value.toString())):(i.othis.parents("li").each(function(){n(this).children("span").children("input").prop("checked",u)}),n.inArray(i.elem.value.toString(),r)>=0&&r.splice(n.inArray(i.elem.value.toString(),r),1));n("#hidSelectedClassNo").val(r.join(","));t.render()});n(document).off("click","#category .submit .layui-btn").on("click","#category .submit .layui-btn",function(){n(this).hasClass("layui-btn-primary")?(n(".advance .selecting").removeClass("selecting"),n("#category").hide(),i.closeAll()):(n(".advance .selecting").val(n("#hidSelectedClassNo").val()).removeClass("selecting"),n("#hidSelectedClassNo").val(""),i.closeAll())});n(document).off("keyup","#searchKeywords").on("keyup","#searchKeywords",function(t){var i=window.event||t,r=i.keyCode||i.which;r==13&&(n("#hid_searchtype").val("search"),basicSearch())});window.basicSearch=function(){var u,f;n("#btnSearch").parent().addClass("searching");var r="",t=n("select[name='identifier']").val(),i=n("input[name='searchKeywords']").val();i!=""&&(t==""&&(t="U"),r=t+"="+i);u=1;f=1;n.StandardPost("/Qikan/Search/Index",{key:encodeURIComponent(r),isNoteHistory:u,isLog:f,indexKey:i,indexIdentifier:t})};window.setCookie=function(t,i){getCookie(t)!=i&&n.cookie(t,i,{path:"/"})};window.getCookie=function(t){var i=n.cookie(t);return i!=null?i:""};window.getSessionSelectArticle=function(){var t="";return n.ajax({type:"post",url:"/WebControl/GetSessionSelectArticle",data:{},dataType:"json",async:!1,success:function(n){n.Result==1&&(t=n.RetValue)},complete:function(){},error:function(){}}),t};window.setSessionSelectArticle=function(t){n.ajax({type:"post",url:"/WebControl/SetSessionSelectArticle",data:{ids:t},dataType:"json",async:!1,success:function(){},complete:function(){},error:function(){}})};n(document).off("click",".search-history .orderread").on("click",".search-history .orderread",function(){var t=n(this).data("lngmysearhistoryguid"),r=n(this).data("showrules");n.ajax({url:"/WebControl/CheckuserType",type:"post",dataType:"json",data:{},beforeSend:function(){loadding()},complete:function(){loaddingClose()},success:function(u){u.RetValue==0?i.confirm(u.PromptMsg,{icon:3,title:"提示"},function(n){loginAction();i.close(n)}):u.RetValue==2?(n("#hidOrgMkey").val(u.Tag),i.confirm(u.PromptMsg,{icon:3,title:"提示"},function(n){loginAction();i.close(n)})):addOrderRead(t,r)},error:function(){loaddingClose()}})});n(document).off("click",".btnSearchhistory").on("click",".btnSearchhistory",function(){window.checklogin(seeSearchhistoryAfterLogin)});window.seeSearchhistoryAfterLogin=function(){window.open("/Qikan/Article/History","_blank")};t.render()});