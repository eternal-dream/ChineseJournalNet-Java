(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b3f986e6"],{1:function(e,t){},2:function(e,t){},"8d28":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("d2-container",{attrs:{type:"full"}},[a("template",{slot:"header"},[a("h4",{staticStyle:{height:"15px"}},[e._v("条件过滤")]),a("el-form",{ref:"form",attrs:{model:e.queryParams,size:"small",inline:!0}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"时间范围","label-width":"80px"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},model:{value:e.daterange,callback:function(t){e.daterange=t},expression:"daterange"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"刊名",prop:"journalName","label-width":"80px"}},[a("el-input",{model:{value:e.queryParams.journalName,callback:function(t){e.$set(e.queryParams,"journalName",t)},expression:"queryParams.journalName"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"分类",prop:"classify","label-width":"80px"}},[a("el-select",{attrs:{size:"mini",filterable:!0,"collapse-tags":!0,multiple:"",clearable:!0,placeholder:"请选择分类"},model:{value:e.queryParams.classNumber,callback:function(t){e.$set(e.queryParams,"classNumber",t)},expression:"queryParams.classNumber"}},e._l(e.statClasses,(function(e){return a("el-option",{key:e.classNumber,attrs:{value:e.classNumber,label:e.name}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"IP地址",prop:"startIp","label-width":"80px"}},[a("el-input",{staticStyle:{width:"48%"},attrs:{placeholder:"IP起"},model:{value:e.queryParams.startIp,callback:function(t){e.$set(e.queryParams,"startIp",t)},expression:"queryParams.startIp"}}),e._v(" - "),a("el-input",{staticStyle:{width:"48%"},attrs:{placeholder:"IP止"},model:{value:e.queryParams.endIp,callback:function(t){e.$set(e.queryParams,"endIp",t)},expression:"queryParams.endIp"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"用户",prop:"userIds","label-width":"80px"}},[a("el-select",{attrs:{size:"mini",filterable:!0,"collapse-tags":!0,multiple:"",clearable:!0,placeholder:"请选择用户"},model:{value:e.queryParams.userIds,callback:function(t){e.$set(e.queryParams,"userIds",t)},expression:"queryParams.userIds"}},e._l(e.users,(function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.userName}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"用户组",prop:"userGroupId","label-width":"80px"}},[a("el-select",{attrs:{size:"mini","collapse-tags":!0,clearable:!0,placeholder:"请选择用户组"},model:{value:e.queryParams.userGroupId,callback:function(t){e.$set(e.queryParams,"userGroupId",t)},expression:"queryParams.userGroupId"}},e._l(e.allGroups,(function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"分析对象",prop:"type","label-width":"80px"}},[a("el-radio-group",{model:{value:e.queryParams.type,callback:function(t){e.$set(e.queryParams,"type",t)},expression:"queryParams.type"}},[a("el-radio",{attrs:{label:"classify"}},[e._v("分类")]),a("el-radio",{attrs:{label:"user"}},[e._v("用户")]),a("el-radio",{attrs:{label:"userGroup"}},[e._v("用户组")]),a("el-radio",{attrs:{label:"ipRange"}},[e._v("用户IP段")]),a("el-radio",{attrs:{label:"custom"}},[e._v(" 自定义 "),a("el-select",{staticStyle:{width:"150px"},model:{value:e.queryParams.customType,callback:function(t){e.$set(e.queryParams,"customType",t)},expression:"queryParams.customType"}},[a("el-option",{attrs:{value:"all",label:"全部汇总"}}),a("el-option",{attrs:{value:"period",label:"周期汇总"}})],1),e._v(" 粒度: "),a("el-select",{staticStyle:{width:"150px"},model:{value:e.queryParams.grainSize,callback:function(t){e.$set(e.queryParams,"grainSize",t)},expression:"queryParams.grainSize"}},[a("el-option",{attrs:{value:"day",label:"日"}}),a("el-option",{attrs:{value:"week",label:"周"}}),a("el-option",{attrs:{value:"month",label:"月"}}),a("el-option",{attrs:{value:"year",label:"年"}})],1)],1)],1)],1)],1),a("el-col",{attrs:{span:20}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:e.analysis}},[e._v("开始分析")])],1),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-tickets",size:"small"},on:{click:e.handleExport}},[e._v("导出EXCEL")])],1)],1)],1),a("template",{slot:"default"},[a("el-table",{attrs:{data:e.analysisResult,size:"mini","empty-text":"未查询到信息",stripe:""}},[a("el-table-column",{attrs:{type:"index",width:"50",label:"序号",align:"center"}}),a("el-table-column",{attrs:{prop:"VALUE",label:"统计名称","min-width":"100px",align:"center"}}),a("el-table-column",{attrs:{prop:"COUNT",label:"次数","min-width":"100px",align:"center"}}),a("el-table-column",{attrs:{prop:"COUNT",label:"所占比例","min-width":"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-progress",{directives:[{name:"show",rawName:"v-show",value:e.analysisResult.length>1,expression:"analysisResult.length>1"}],attrs:{percentage:0==e.analysisResult[e.analysisResult.length-1].COUNT?100:parseInt(t.row.COUNT/e.analysisResult[e.analysisResult.length-1].COUNT*100)}})]}}])})],1)],1)],2)},l=[],r=a("bc3a"),i=a.n(r),n=a("ca3f"),o={name:"DownStatistics",components:{},data:function(){return{queryParams:{type:"classify",customType:"all",grainSize:"day",visitType:"Download"},multipleSelection:[],ids:[],allGroups:[],total:0,users:[],ipReg:/^((25[0-5]|2[0-4]\d|1\d\d|[0-9]\d|[0]\d{2}|[0]{2}\d|\d|0\d)\.){3}(25[0-5]|2[0-4]\d|1\d\d|[0-9]\d|[1-9]|[0]\d{2}|[0]{2}\d)$/,plates:[],statClasses:[],daterange:[],analysisResult:[],pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]}}},created:function(){this.getAllPlates(),this.getAllUser(),this.getAllGroups(),this.getStatClasses()},methods:{analysis:function(){var e=this;!this.queryParams.startIp||this.ipReg.test(this.queryParams.startIp)?!this.queryParams.endIp||this.ipReg.test(this.queryParams.endIp)?(this.daterange?(this.queryParams.startTime=this.daterange[0],this.queryParams.endTime=this.daterange[1]):(this.queryParams.startTime=void 0,this.queryParams.endTime=void 0),i()({method:"post",url:"/system/statistics/downloadAnalysis",data:this.queryParams}).then((function(t){e.analysisResult=t.data.result}))):this.$message.error("结束IP不正确,请检查!"):this.$message.error("起始IP不正确,请检查!")},getAllPlates:function(){var e=this;this.$axiosRequest("/system/userLog/getAllPlates",{},{method:"get"}).then((function(t){e.plates=t.plates}))},getStatClasses:function(){var e=this;this.$axiosRequest("/system/statClass/getStatClasses",{},this.$axiosOptions("get")).then((function(t){e.statClasses=t.statClasses}))},getAllUser:function(){var e=this;this.$axiosRequest("/system/user/getAllUser",{},this.$axiosOptions("get")).then((function(t){e.users=t.users}))},handleQuery:function(){this.queryParams.pageNum=1,this.searchGroup()},handlePageChange:function(e){this.queryParams.pageNum=e,this.searchGroup()},handleSelectionChange:function(e){this.multipleSelection=e},getAllGroups:function(){var e=this;this.$axiosRequest("/system/userGroup/getAllGroups",{},this.$axiosOptions("get")).then((function(t){e.allGroups=t.allGroups}))},handleExport:function(){!this.queryParams.startIp||this.ipReg.test(this.queryParams.startIp)?!this.queryParams.endIp||this.ipReg.test(this.queryParams.endIp)?(this.daterange&&(this.queryParams.startTime=this.daterange[0],this.queryParams.endTime=this.daterange[1]),i()({method:"post",url:"/system/statistics/downloadExport",data:this.queryParams,responseType:"blob"}).then((function(e){Object(n["a"])(e)}))):this.$message.error("结束IP不正确,请检查!"):this.$message.error("起始IP不正确,请检查!")}}},u=o,c=a("2877"),p=Object(c["a"])(u,s,l,!1,null,null,null);t["default"]=p.exports},ca3f:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return r}));a("d3b7"),a("4d63"),a("ac1f"),a("25f0"),a("3ca3"),a("5319"),a("1276"),a("ddb0"),a("2b3d");function s(e){var t=e.headers["content-disposition"],s=t.split("filename=")[1],l=new Blob([e.data]),r=a("acf9");if(r.skipDecodeWarning=!0,s=r.decode(s,"utf-8"),"msSaveOrOpenBlob"in navigator)window.navigator.msSaveOrOpenBlob(l,decodeURI(s));else{var i=window.URL||window.webkitURL,n=i.createObjectURL(l),o=document.createElement("a");o.href=n,o.download=decodeURI(s),o.click(),i.revokeObjectURL(n)}}function l(e){var t=this;return new Promise((function(a,s){t.$axiosRequest("/view/detail/readLimitCheck",{lngid:e},t.$axiosOptions("get")).then((function(s){if(console.log("res",s),s.data.limited)t.$confirm(s.data.msg,"提示",{showCancelButton:!1,type:"warning"}),a(s);else{e=encodeURIComponent(e);var l="/api/view/detail/readPdf?lngid="+e,r=window.location.origin;window.open(r+"/pdfjs/web/viewer.html?file="+encodeURIComponent(l))}}))}))}function r(e){var t=this,a=this.$loading({lock:!0,text:"下载中...",backgroundColor:"rgba(55,55,55,0.4)",spinner:"el-icon-loading",target:document.querySelector(".el-table__body")});return new Promise((function(l,r){t.$axiosRequest("/view/detail/downloadLimitCheck",{lngid:e},t.$axiosOptions("get")).then((function(i){console.log("res",i),i.data.limited?(t.$confirm(i.data.msg,"提示",{showCancelButton:!1,type:"warning"}),a.close(),l(i)):t.$axiosRequest("/view/detail/downloadPdf",{lngid:e},t.$axiosOptions("get",null,"blob")).then((function(e){if(!e.data.size>0)return t.$confirm("文件不存在,下载失败!","提示",{showCancelButton:!1,type:"warning"}),void l(e);s(e),l(e)})).catch((function(e){r(e)})).finally((function(e){a.close()}))}))}))}}}]);